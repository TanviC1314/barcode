<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Barcode Scanner</title>
  <style>
    #scanner-container {
      width: 100%;
      max-width: 600px;
      margin: auto;
      text-align: center;
    }
    video {
      width: 100%;
      border: 1px solid #ccc;
    }
    #result {
      margin-top: 20px;
      font-size: 18px;
      font-weight: bold;
    }
    #status-message {
      margin-top: 10px;
      font-size: 16px;
      color: #888;
    }
    #status-message.success {
      color: green;
    }
    #status-message.error {
      color: red;
    }
  </style>
</head>
<body>
  <div id="scanner-container">
    <h1>Barcode Scanner</h1>
    <div id="video-container"></div>
    <div id="result">Scanned Value: <span id="barcode-value">None</span></div>
    <div id="status-message">Waiting for barcode...</div> <!-- Status message -->
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const videoContainer = document.getElementById('video-container');
      const barcodeValueElement = document.getElementById('barcode-value');
      const statusMessageElement = document.getElementById('status-message');

      Quagga.init(
        {
          inputStream: {
            name: "Live",
            type: "LiveStream",
            target: videoContainer, // The video element where the stream will be displayed
            constraints: {
              width: 640,
              height: 480,
              facingMode: "environment", // Use back camera
            },
          },
          decoder: {
            readers: ["code_128_reader", "ean_reader", "ean_8_reader"], // List of barcode formats
          },
        },
        function (err) {
          if (err) {
            console.error("Error initializing Quagga:", err);
            statusMessageElement.textContent = "Error initializing scanner. Please try again.";
            statusMessageElement.classList.add('error');
            return;
          }
          console.log("Quagga initialized successfully");
          statusMessageElement.textContent = "Waiting for barcode...";
          statusMessageElement.classList.remove('error', 'success');
          Quagga.start(); // Start the scanner
        }
      );

      Quagga.onDetected((data) => {
        const barcodeValue = data.codeResult.code;
        console.log("Barcode detected:", barcodeValue); // Log to console
        barcodeValueElement.textContent = barcodeValue; // Display on the page

        // Update the status message
        statusMessageElement.textContent = `Barcode detected: ${barcodeValue}`;
        statusMessageElement.classList.remove('error');
        statusMessageElement.classList.add('success');

        // Optional: Stop scanning after detecting the barcode
        Quagga.stop();
      });

      // Handle case when no barcode is detected in the stream
      Quagga.onProcessed((result) => {
        if (result && !result.codeResult) {
          statusMessageElement.textContent = "No barcode detected, please try again.";
          statusMessageElement.classList.remove('success');
          statusMessageElement.classList.add('error');
        }
      });
    });
  </script>
</body>
</html>
